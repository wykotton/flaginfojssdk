"use strict";(function(t,e){if(typeof module!=="undefined"&&module.exports){module.exports=e()}else if(typeof define==="function"&&define.amd){define(e)}else{t.fg=e.call(t)}})(window,function(){"use strict";function t(){var e="kot",o="1.1.4",n=false,i={chalk:"",theme:"default",origColor:"#409EFF",broHis:[],routertState:false,broHisFrom:"",broHisTo:"",broState:false,broDirection:""};var r=function e(){t.option=i;return t};var s=function e(o){for(var n=o.length-1;n>=0;n--){t["get"+o[n].substring(0,1).toUpperCase()+o[n].substring(1)]=function(e){return function(){var n=t[o[e]]||t.getQueryObject()[o[e]];if(!n)t.msg("获取"+o[e]+"失败,请嵌入企业门户并在fg.ready回调用使用该方法");return n}}(n)}};var a=function t(e){return typeof e==="function"};return{initFunction:function t(){r();s(["token","userInfo","appId","moduleId","theme","color","businessType","spId"])},init:function t(){this.sendMessage({t:"finish",d:{href:window.location.origin+window.location.pathname,h:document.body.scrollHeight}})},listenMsg:function t(e,o){var n=this;window.addEventListener("message",function(t){var i=t.data.fi;if(!i)return;if(o==="ready"&&n.option.token&&a(e)){e({token:n.option.token,appId:n.option.appId,userInfo:n.option.userInfo,theme:n.option.theme,spId:n.option.spId,moduleId:n.option.moduleId,businessType:n.option.businessType,color:n.option.color,v:n.option.version})}else if(o==="ready"&&!n.option.token){n.option=Object.assign(n.option,t.data.fi);n.setTheme(n.option.theme,n.option.color,n.option.v);if(a(e))return e(i)}else{if(a(e))return e(i);if(typeof e!=="undefined"){if(i.success&&a(e.onSuccess))e.onSuccess(i.obj);if(!i.success&&a(e.onFail))e.onFail(i.obj)}}},false)},sendMessage:function t(e){if(window.top===window){console.log("请嵌入企业门户中使用改方法："+e.t)}else{window.parent.postMessage({fi:e},"*")}},cookie:{set:function t(e,o,n){var i=new Date;var r=window.location.hostname;var s=r.split(".");var a=s.length<3?r:(s.splice(0,1),s.join("."));i.setTime(i.getTime()+24*60*60*1e3*n);window.document.cookie=e+"="+o+";path=/;domain="+a+";expires="+i.toGMTString()},get:function t(e){var o=window.document.cookie.match("(^|;) ?"+e+"=([^;]*)(;|$)");return o?o[2]:null},delete:function t(e){this.set(e,"",-1)}},ready:function t(e){try{if(window.top===window)r().setTheme();else this.listenMsg(e,"ready")}catch(t){n=true;return this}return this},catch:function t(e){if(typeof e==="function"&&n){n=true;e()}},MF:function t(e,o,i){try{this.sendMessage({t:e,d:o});this.listenMsg(i,e)}catch(t){console.log(t);n=true;return this}return this},hashNavigation:function t(e,o){this.MF("hashNavigation",e,o)},loginOut:function t(){this.sendMessage({t:"loginOut"})},goto:function t(e){this.sendMessage({t:"goto",d:e})},setTheme:function t(e,o,n){var i=e||this.getQueryObject().theme;var r=o||this.getQueryObject().color;if(i)this.option.theme=i;var s=document.createElement("link");s.rel="stylesheet";s.href="/static/theme/"+this.option.theme+"/index.css";var a=document.getElementsByTagName("head")[0];document.head.appendChild(s);if(r&&r!==this.option.origColor){this.setColor(r,this.option.origColor,n)}else{document.body.style.display="block"}},setColor:function t(e,o,n){if(typeof e!=="string")return;var i=this.getThemeCluster(e.replace("#",""));var r=this.getThemeCluster(o.replace("#",""));var s=this;var a=function t(e,o){return function(){var t=s.getThemeCluster(s.option.origColor.replace("#",""));var n=s.updateStyle(s[e],t,i);var r=document.getElementById(o);if(!r){r=document.createElement("style");r.setAttribute("id",o);document.head.appendChild(r)}r.innerText=n}};var c=a("chalk","chalk-style");var u=n||this.getQueryObject().v;if(!this.option.chalk){var l="https://unpkg.com/element-ui@"+u+"/lib/theme-chalk/index.css";this.getCSSString(l,c,"chalk")}else{c()}var f=[].slice.call(document.querySelectorAll("style")).filter(function(t){var e=t.innerText;return new RegExp(o,"i").test(e)&&!/Chalk Variables/.test(e)});f.forEach(function(t){var e=t.innerText;if(typeof e!=="string")return;t.innerText=s.updateStyle(e,r,i)})},updateStyle:function t(e,o,n){var i=e;o.forEach(function(t,e){i=i.replace(new RegExp(t,"ig"),n[e])});return i},getCSSString:function t(e,o,n){var i=new XMLHttpRequest;var r=this;i.onreadystatechange=function(){if(i.readyState===4&&i.status===200){r[n]=i.responseText.replace(/@font-face{[^}]+}/,"");o();document.body.style.display="block"}};i.open("GET",e);i.send()},getThemeCluster:function t(e){var o=function t(e,o){var n=parseInt(e.slice(0,2),16);var i=parseInt(e.slice(2,4),16);var r=parseInt(e.slice(4,6),16);if(o===0){return[n,i,r].join(",")}else{n+=Math.round(o*(255-n));i+=Math.round(o*(255-i));r+=Math.round(o*(255-r));n=n.toString(16);i=i.toString(16);r=r.toString(16);return"#"+n+i+r}};var n=function t(e,o){var n=parseInt(e.slice(0,2),16);var i=parseInt(e.slice(2,4),16);var r=parseInt(e.slice(4,6),16);n=Math.round((1-o)*n);i=Math.round((1-o)*i);r=Math.round((1-o)*r);n=n.toString(16);i=i.toString(16);r=r.toString(16);return"#"+n+i+r};var i=[e];for(var r=0;r<=9;r++){i.push(o(e,Number((r/10).toFixed(2))))}i.push(n(e,.1));return i},getQueryObject:function t(e){e=e==null?window.location.href:e;var o=e.substring(e.lastIndexOf("?")+1);var n={};var i=/([^?&=]+)=([^?&=]*)/g;o.replace(i,function(t,e,o){var i=decodeURIComponent(e);var r=decodeURIComponent(o);r=String(r);n[i]=r;return t});return n},msg:function t(e,o){if(!arguments.length)return;if(arguments.length===1)o=e,e="danger";switch(e){case"success":console.log("%cfrom fg："+o,"color: #67C23A");break;case"warning":console.log("%cWarning from fg："+o,"color: #E6A23C");break;case"danger":console.log("%cError fg："+o,"color: #F56C6C");break;case"info":console.log("%cfrom fg："+o,"color: #909399");break;default:console.log("%cError from fg："+o,"color: #F56C6C");break}},routerState:function t(e,o){var n=this;this.option.broHisFrom=o.fullPath;this.option.broHisTo=e.fullPath;var i={meta:{title:e.meta.title},path:e.fullPath};var r={meta:{title:o.meta.title},path:o.fullPath};this.routertState=true;this.option.broHis.push(this.option.broHisTo);setTimeout(function(){n.MF("routerState",{direction:n.option.broDirection,to:i,from:r});n.option.broDirection=""},60)},historyListening:function t(e,o){var n=this;if(window.history&&window.history.pushState){window.onpopstate=function(t){var e=setInterval(function(){if(n.routertState){if(!n.option.broState){n.option.broHis=[n.option.broHisFrom,n.option.broHisTo];n.option.broState=true;n.hashNavigation("back");n.option.broDirection="back"}else{if(window.location.hash.split("#")[1]===n.option.broHis[n.option.broHis.length-2]){n.option.broHis.pop();n.hashNavigation("forward");n.option.broDirection="forward"}else{n.hashNavigation("back");n.option.broDirection="back"}}n.routertState=false;window.clearInterval(e)}},500)}}}}}t=new t;t.initFunction();window.onload=function(e){t.init();t.historyListening()};return t});